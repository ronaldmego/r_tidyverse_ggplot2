---
title: "tidyverse"
author: "Ronald Mego"
date: "11/20/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r, echo=FALSE}}
library(tidyverse)
library(nycflights13)
```

```{r}
?flights
nycflights13::flights
data(flights)
View(flights)
```

#funciones:
filter() -> filtrar observaciones a partir de valores concretos
arrange -> reordenar las filas
select() -> seleccionar variables por sus nombres
mutate() -> crea nuevas variables con funciones a partir de las existentes
summarise() -> colapsar varios valores para dar un resumen de los mismos

group_by() -> opera la función a la que acompaña grupo a grupo

orden de usar las funciones:
1 - dataframe
2 - operaciones que queremos hacer a las variables del dataframe
3 - resultado en un nuevo dataframe

###FILTER: devuelve un dataframe
```{r}
jan1 <- filter ( flights , month == 1 , day == 1 ) #vuelos del 1/1
may19 <-  filter (flights , month == 5 , day == 19 ) #vuelos del 19/5
dec25 <- filter (flights, month == 12 , day == 25 ) #vuelos el 25/12
```


```{r}
filter (flights , month == 5 | month == 6 ) #filtra donde el mes es mayo o junio
filter( flights , month %in% c ( 5 , 6) ) #filtra donde el mes es mayo o junio

filter (flights , arr_delay <= 60 , dep_delay <= 60) #filtra los vuelos cuyo delay de llegada sea maximo de una hora
filter (flights , !(arr_delay>60 | dep_delay>60)) #filtra los vuelos cuyo delay de llegada sea maximo de una hora.usando la ley de morgan
```

```{r}
age.mery<-NA
is.na(age.mery) #como identificar los NA
```

```{r}
df <- tibble (x = c (1,2,NA,4,5)) #data demo con NA
filter(df,is.na(x)|x>2) #subconjunto que incluye el NA
```
```{r}
head(flights) # 6 primeras filas
tail(flights) # 6 ultimas filas
```

#ARRANGE (de menor a mayor)
se visualiza que los datos de "flights" no estan ordenados, entonces los reordenamos:
```{r}
sorted_date <- arrange(flights , year,month,day)
tail(sorted_date)
```

#ARRANGE (de mayor a menor)
```{r}
arrange(flights , desc(arr_delay)) %>% head(.) #el que tuvo mas retraso de partida
arrange(flights, desc(dep_delay)) %>% head(.) #el que tuvo mas retraso de llegada
```

¿Cómo se ordenan los NA? Siempre se van al final
```{r}
arrange(df,x)  #NA se va al final
arrange(df,desc(x)) #NA se va al final
```
```{r}
#el vuelo que mas recorrio
arrange(flights , desc(distance)) %>% head(.) 
```

```{r}
#Encuentra todos los vuelos que llegaron más de una hora tarde de lo previsto.
filter(flights , arr_delay>60) 
```
```{r}
#Encuentra todos los vuelos que volaron hacia San Francisco (aeropuertos SFO y OAK)
filter(flights , dest %in% c("SFO","OAK") ) s
```
```{r}
#Encuentra todos los vuelos operados por United American (UA) o por American Airlines (AA)
filter(flights , carrier %in% c("UA","AA")) 
```

```{r}
#Encuentra todos los vuelos que salieron los meses de primavera (Abril, Mayo y Junio)
filter(flights , month %in% c(4,5,6)) 
```

```{r}
#Encuentra todos los vuelos que llegaron más de una hora tarde pero salieron con menos de una hora de retraso.
filter(flights , dep_delay<60 & arr_delay>60) 
```
```{r}
#Encuentra todos los vuelos que llegaron más de una hora tarde pero salieron con menos de una hora de retraso.
filter ( flights , arr_delay > 60 & dep_delay < 60 ) 
```

```{r}
#Encuentra todos los vuelos que salieron con más de una hora de retraso pero consiguieron llegar con menos de 30 minutos de retraso (el avión aceleró en el aire)
filter ( flights , dep_delay > 60 & arr_delay < 30)
```

```{r}
#Encuentra todos los vuelos que salen entre medianoche y las 7 de la mañana (vuelos nocturnos).
filter ( flights , dep_time > 0000 & dep_time<0700) 
```
```{r}
#Investiga el uso de la función between() de dplyr. ¿Qué hace? Puedes usarlo para resolver la sintaxis necesaria para responder alguna de las preguntas anteriores?

filter ( flights , between( dep_time , 0000 , 0700) ) 
```
```{r}
#¿Cuantos vuelos tienen un valor desconocido de dep_time?
filter( flights , is.na(dep_time))
```
```{r}
#¿Qué variables del dataset contienen valores desconocidos? ¿Qué representan esas filas donde faltan los datos?

colnames(flights)[colSums(is.na(flights)) > 0]
```
```{r}
NA^0
NA|TRUE
FALSE&NA
```

